function FilterBox(e,t,n,a,l){if(!(this instanceof FilterBox))return new FilterBox(e,t,n,a,l);var t=t,o=t.getSubLayer(n),a=a,r=t.getSubLayer(n).getSQL().replace(/\n/g,"\n "),d=t.options.sql_api_protocol+"://"+t.options.user_name+"."+t.options.sql_api_domain+":"+t.options.sql_api_port+t.options.sql_api_endpoint,s=$("#"+e),c="(ukendt)",p=function(){for(var e=0,t=0;t<a.length;t++)$("#filterheader").append("<th>"+a[t].title+"</th>"),$("#filterbody").append('<td id="filter_'+a[t].name+'"></td>'),"unique"==a[t].type&&(query="SELECT DISTINCT "+a[t].name+" FROM ("+r+") a ORDER BY "+a[t].name+" ASC;"),"year"==a[t].type&&(query="SELECT DISTINCT date_part('year',"+a[t].name+"::date) as "+a[t].name+" FROM ("+r+") a ORDER BY "+a[t].name+" ASC;"),query&&$.getJSON(d+"?q="+encodeURIComponent(query),function(e){$.each(e.fields,function(t,i){fields=[],column=e.fields[0],console.log(e),$.each(e.rows,function(e,i){i[t]?fields.push(i[t]):fields.push(c)});var n='<fieldset id="fieldset_'+t+'">';for(j=0;j<fields.length;j++)n+='<input type="checkbox" checked="true" name="'+t+"_"+j+'" />&nbsp;<label for="'+t+"_"+j+'">'+fields[j]+"</label><br />";n+="</fieldset>",$("#filter_"+t).append(n),$("#filter_"+t).children("fieldset").children("input:checkbox").click(f)})}).done(function(t){e+=1,e==a.length&&f()})},u=function(){where_part="WHERE ";var e,t=!1;for(i=0;i<a.length;i++){for(this_part="",checked_inputs=$("#fieldset_"+a[i].name).children("input:checked"),none_checked=0==checked_inputs.length,where_part.length>6&&(this_part+=" AND "),t=!1,e=[],j=0;j<checked_inputs.length;j++)$("label[for='"+checked_inputs[j].name+"']")[0].textContent==c?t=!0:e.push($("label[for='"+checked_inputs[j].name+"']")[0].textContent);for("unique"==a[i].type&&(this_part+="("+a[i].name+" IN ("),"year"==a[i].type&&(this_part+="(date_part('year',"+a[i].name+"::date) IN ("),j=0;j<e.length;j++)this_part+="'"+e[j]+"'",j+1<e.length&&(this_part+=",");0==e.length&&(this_part+="'foo'"),this_part+=")",t&&(this_part+=" OR "+a[i].name+" IS NULL"),this_part+=")",where_part+=this_part}return where_part.length>6?(console.log("SELECT * FROM ("+r+") a "+where_part),"SELECT * FROM ("+r+") a "+where_part):r},f=function(){$("#filtersubmit").prop("disabled",!0),query="SELECT COUNT(*) FROM ("+u()+") cnt",$.getJSON(d+"?q="+encodeURIComponent(query),function(e){console.log(e.rows[0].count),$("#filtercount").children("span.value").text(e.rows[0].count),e.rows[0].count>0&&$("#filtersubmit").prop("disabled",!1)})},h=function(){$("#filtersubmit").click(function(){f();var e=u();e!=r&&(o.setSQL(e),$("#filterModal").modal("toggle"))})};s.append('<div id="filtercontrol"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#filterModal">Filter!!</button></div>'),s.append('<div class="modal fade" id="filterModal" role="dialog"><div class="modal-dialog"><div class="modal-content"><form name="filter_form" action=""><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h3>V&aelig;lg filtre:</h3></div><div class="modal-body"><table><tr id="filterheader"></tr><tr id="filterbody"></tr></table></div><div class="modal-footer"><div id="filtercount">Du har valgt <span class="value">0</span> projekter.</div><button type="button" class="btn btn-default btn-close" data-dismiss="modal" id="filtersubmit">Udf√∏r</button></div></form></div></div></div>'),p(),h(),this.rebuildFilters=function(){}}